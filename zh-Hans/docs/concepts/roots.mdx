---
title: "根目录"
description: "理解 MCP 中的根目录"
---

根目录是 Model Context Protocol (MCP) 中的一个可选功能，允许客户端指定服务器应该关注的数据源。

## 根目录是什么？

根目录代表服务器应该监视或索引的数据源位置。这些可以是：

- 文件系统路径
- 数据库连接字符串
- API 端点
- 其他数据源 URI

每个根目录都有一个唯一的 URI 和可选的描述。

## 根目录管理

客户端可以通过以下方法管理根目录：

<CodeGroup>
```typescript TypeScript
// 添加根目录
await client.addRoot({
  uri: "file:///path/to/docs",
  description: "文档目录"
});

// 移除根目录
await client.removeRoot("file:///path/to/docs");

// 列出根目录
const roots = await client.listRoots();
```

```python Python
# 添加根目录
client.add_root(
    uri="file:///path/to/docs",
    description="文档目录"
)

# 移除根目录
client.remove_root("file:///path/to/docs")

# 列出根目录
roots = client.list_roots()
```
</CodeGroup>

## 根目录变更通知

服务器可以通知客户端根目录列表的变更：

```json
{
  "jsonrpc": "2.0",
  "method": "roots/changed",
  "params": {
    "added": [
      {
        "uri": "file:///new/path",
        "description": "新添加的目录"
      }
    ],
    "removed": [
      "file:///old/path"
    ]
  }
}
```

## 根目录配置

服务器可以通过配置文件定义默认的根目录：

```json
{
  "roots": [
    {
      "uri": "file:///data/docs",
      "description": "主文档存储"
    },
    {
      "uri": "api://example.com/data",
      "description": "API 数据源"
    }
  ]
}
```

这个配置建议服务器同时关注本地仓库和 API 端点，同时保持它们在逻辑上分离。

## 实现根目录支持

要在您的服务器中实现根目录支持：

1. 启用根目录功能：

<CodeGroup>
```typescript TypeScript
const server = new McpServer({
  capabilities: {
    roots: true
  }
});
```

```python Python
server = McpServer(
    capabilities={"roots": True}
)
```
</CodeGroup>

2. 处理根目录事件：

<CodeGroup>
```typescript TypeScript
server.on("rootAdded", async (root) => {
  // 开始监视新的根目录
  await startWatching(root.uri);
});

server.on("rootRemoved", async (uri) => {
  // 停止监视根目录
  await stopWatching(uri);
});
```

```python Python
@server.on("root_added")
async def handle_root_added(root):
    # 开始监视新的根目录
    await start_watching(root.uri)

@server.on("root_removed")
async def handle_root_removed(uri):
    # 停止监视根目录
    await stop_watching(uri)
```
</CodeGroup>

## 最佳实践

实现根目录支持时要考虑：

- 验证根目录 URI
- 实现适当的错误处理
- 管理监视器资源
- 处理重复的根目录
- 实现根目录访问控制
- 考虑性能影响
- 处理根目录不可用的情况
- 提供有意义的错误消息 