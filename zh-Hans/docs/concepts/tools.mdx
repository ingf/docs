---
title: "工具"
description: "使 LLMs 能够通过您的服务器执行操作"
---

工具是 Model Context Protocol (MCP) 中的一个强大原语,它使服务器能够向客户端暴露可执行的功能。通过工具,LLMs 可以与外部系统交互、执行计算并在现实世界中采取行动。

<Note>
  工具被设计为**模型控制**,这意味着工具从服务器暴露给客户端时,是为了让 AI 模型能够自动调用它们(在人工审核批准的情况下)。
</Note>

## 概述

MCP 中的工具允许服务器暴露可以被客户端调用并被 LLMs 用来执行操作的可执行函数。工具的关键方面包括:

- **发现**: 客户端可以通过 `tools/list` 端点列出可用的工具
- **调用**: 工具使用 `tools/call` 端点调用,服务器执行请求的操作并返回结果
- **灵活性**: 工具可以从简单的计算到复杂的 API 交互

像[资源](/docs/concepts/resources)一样,工具由唯一的名称标识,并可以包含描述来指导其使用。但是,与资源不同,工具代表可以修改状态或与外部系统交互的动态操作。

## 工具定义结构

每个工具都使用以下结构定义:

```typescript
{
  name: string;          // 工具的唯一标识符
  description?: string;  // 人类可读的描述
  inputSchema: {         // 工具参数的 JSON Schema
    type: "object",
    properties: { ... }  // 工具特定的参数
  }
}
```

## 实现工具

这是在 MCP 服务器中实现基本工具的示例:

<Tabs>
  <Tab title="TypeScript">
    ```typescript
    const server = new Server({
      name: "example-server",
      version: "1.0.0"
    });

    // 注册工具
    server.addTool({
      name: "calculator",
      description: "执行基本的数学运算",
      inputSchema: {
        type: "object",
        properties: {
          operation: {
            type: "string",
            enum: ["add", "subtract", "multiply", "divide"]
          },
          a: { type: "number" },
          b: { type: "number" }
        },
        required: ["operation", "a", "b"]
      },
      handler: async (params) => {
        const { operation, a, b } = params;
        let result;
        
        switch(operation) {
          case "add": result = a + b; break;
          case "subtract": result = a - b; break;
          case "multiply": result = a * b; break;
          case "divide": 
            if(b === 0) throw new Error("除数不能为零");
            result = a / b;
            break;
        }

        return {
          content: [{
            type: "text",
            text: `结果是 ${result}`
          }]
        };
      }
    });
    ```
  </Tab>
  <Tab title="Python">
    ```python
    app = McpServer(
        name="example-server",
        version="1.0.0"
    )

    @app.tool(
        name="calculator",
        description="执行基本的数学运算",
        input_schema={
            "type": "object",
            "properties": {
                "operation": {
                    "type": "string",
                    "enum": ["add", "subtract", "multiply", "divide"]
                },
                "a": {"type": "number"},
                "b": {"type": "number"}
            },
            "required": ["operation", "a", "b"]
        }
    )
    async def calculator(params: dict) -> CallToolResult:
        operation = params["operation"]
        a = params["a"]
        b = params["b"]
        
        try:
            if operation == "add": result = a + b
            elif operation == "subtract": result = a - b
            elif operation == "multiply": result = a * b
            elif operation == "divide":
                if b == 0: raise ValueError("除数不能为零")
                result = a / b
                
            return CallToolResult(
                content=[
                    TextContent(
                        type="text",
                        text=f"结果是 {result}"
                    )
                ]
            )
        except Exception as error:
            return CallToolResult(
                isError=True,
                content=[
                    TextContent(
                        type="text",
                        text=f"错误: {str(error)}"
                    )
                ]
            )
    ```
  </Tab>
</Tabs>

这种方法允许 LLM 看到发生了错误并可能采取纠正措施或请求人工干预。

## 测试工具

MCP 工具的全面测试策略应该涵盖:

- **功能测试**: 验证工具使用有效输入正确执行并适当处理无效输入
- **集成测试**: 使用真实和模拟的依赖项测试工具与外部系统的交互
- **安全测试**: 验证认证、授权、输入净化和速率限制
- **性能测试**: 检查负载下的行为、超时处理和资源清理
- **错误处理**: 确保工具通过 MCP 协议正确报告错误并清理资源 